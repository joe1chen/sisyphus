(function(c){c.sisyphus=function(){return Sisyphus.getInstance()};c.fn.sisyphus=function(c){var e=Sisyphus.getInstance();e.setOptions(c);e.protect(this);return e};var g={isAvailable:function(){if("object"===typeof c.jStorage)return!0;try{return localStorage.getItem}catch(b){return!1}},set:function(b,e){if("object"===typeof c.jStorage)c.jStorage.set(b,e+"");else try{localStorage.setItem(b,e+"")}catch(f){}},get:function(b){return"object"===typeof c.jStorage?(b=c.jStorage.get(b))?b.toString():b:localStorage.getItem(b)},
remove:function(b){"object"===typeof c.jStorage?c.jStorage.deleteKey(b):localStorage.removeItem(b)}};Sisyphus=function(){var b,e;function f(){return{setInitialOptions:function(a){var d={excludeFields:null,customKeyPrefix:"",timeout:0,autoRelease:!0,name:null,onSave:function(){},onBeforeRestore:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||c.extend(d,a);this.browserStorage=g},setOptions:function(a){this.options=this.options||this.setInitialOptions(a);this.options=
c.extend(this.options,a)},protect:function(a){a=a||{};this.targets=this.targets||[];this.href=this.options.name||location.hostname+location.pathname+location.search;this.targets=c.merge(this.targets,a);this.targets=c.unique(this.targets);this.targets=c(this.targets);if(!this.browserStorage.isAvailable())return!1;this.restoreAllData();this.options.autoRelease&&this.bindReleaseData();b||(this.bindSaveData(),b=!0)},bindSaveData:function(){var a=this;a.options.timeout&&a.saveDataByTimeout();a.targets.each(function(){var d=
c(this.elements).not(":submit").not(":reset").not(":button");a.options.excludeFields&&(d=d.not(a.options.excludeFields));d.each(function(){var d=c(this);d.is(":text")||d.is("textarea")?a.options.timeout||a.bindSaveDataImmediately(d):a.bindSaveDataOnChange(d)})})},saveAllData:function(){var a=this;a.targets.each(function(){var d=c(this).attr("id"),b=c(this.elements).not(":submit").not(":reset").not(":button");a.options.excludeFields&&(b=b.not(a.options.excludeFields));b=b.serialize();a.saveToBrowserStorage(a.href+
d+a.options.customKeyPrefix,b,!1)});c.isFunction(a.options.onSave)&&a.options.onSave.call()},restoreAllData:function(){var a=this;c.isFunction(a.options.onBeforeRestore)&&a.options.onBeforeRestore.call();a.targets.each(function(){var d=c(this),b=d.attr("id");(b=a.browserStorage.get(a.href+b+a.options.customKeyPrefix))&&d.deserialize(b,function(){c.isFunction(a.options.onRestore)&&a.options.onRestore.call()})})},bindSaveDataImmediately:function(a){var d=this;if(null==c.browser.msie)a.on("input",function(){d.saveAllData()});
else a.on("propertychange",function(){d.saveAllData()})},saveToBrowserStorage:function(a,d,b){b=null==b?!0:b;this.browserStorage.set(a,d);b&&(""!==d&&c.isFunction(this.options.onSave))&&this.options.onSave.call()},bindSaveDataOnChange:function(a){var b=this;a.change(function(){b.saveAllData()})},saveDataByTimeout:function(){var a=this;setTimeout(function(){function b(){a.saveAllData();setTimeout(b,1E3*a.options.timeout)}return b}(a.targets),1E3*a.options.timeout)},bindReleaseData:function(){var a=
this;a.targets.each(function(){var b=c(this).attr("id");c(this).bind("submit reset",function(){a.releaseData(b)})})},manuallyReleaseData:function(){var a=this;a.targets.each(function(){var b=c(this).attr("id");a.releaseData(b)})},releaseData:function(a){this.browserStorage.remove(this.href+a+this.options.customKeyPrefix);c.isFunction(this.options.onRelease)&&this.options.onRelease.call()}}}b=e=null;return{getInstance:function(){e||(e=f(),e.setInitialOptions());return e},free:function(){e=b=void 0;
return null}}}()})(jQuery);