(function(c){c.sisyphus=function(){return Sisyphus.getInstance()};c.fn.sisyphus=function(c){var f=Sisyphus.getInstance();f.setOptions(c);f.protect(this);return f};var h={isAvailable:function(){if("object"===typeof c.jStorage)return!0;try{return localStorage.getItem}catch(e){return!1}},set:function(e,f){if("object"===typeof c.jStorage)c.jStorage.set(e,f+"");else try{localStorage.setItem(e,f+"")}catch(g){}},get:function(e){return"object"===typeof c.jStorage?(e=c.jStorage.get(e))?e.toString():e:localStorage.getItem(e)},
remove:function(e){"object"===typeof c.jStorage?c.jStorage.deleteKey(e):localStorage.removeItem(e)}};Sisyphus=function(){var e,f;function g(){return{setInitialOptions:function(a){var b={excludeFields:null,customKeyPrefix:"",timeout:0,autoRelease:!0,onSave:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||c.extend(b,a);this.browserStorage=h},setOptions:function(a){this.options=this.options||this.setInitialOptions(a);this.options=c.extend(this.options,a)},protect:function(a){a=
a||{};this.targets=this.targets||[];this.href=location.hostname+location.pathname+location.search;this.targets=c.merge(this.targets,a);this.targets=c.unique(this.targets);this.targets=c(this.targets);if(!this.browserStorage.isAvailable())return!1;this.restoreAllData();this.options.autoRelease&&this.bindReleaseData();e||(this.bindSaveData(),e=!0)},bindSaveData:function(){var a=this;a.options.timeout&&a.saveDataByTimeout();a.targets.each(function(){var b=c(this.elements).not(":submit").not(":reset").not(":button");
a.options.excludeFields&&(b=b.not(a.options.excludeFields));b.each(function(){var b=c(this);b.is(":text")||b.is("textarea")?a.options.timeout||a.bindSaveDataImmediately(b):a.bindSaveDataOnChange(b)})})},saveAllData:function(){var a=this;a.targets.each(function(){var b=c(this).attr("id"),d=c(this.elements).not(":submit").not(":reset").not(":button");a.options.excludeFields&&(d=d.not(a.options.excludeFields));d=d.serialize();a.saveToBrowserStorage(a.href+b+a.options.customKeyPrefix,d,!1)});c.isFunction(a.options.onSave)&&
a.options.onSave.call()},restoreAllData:function(){var a=this;a.targets.each(function(){var b=c(this),d=b.attr("id");(d=a.browserStorage.get(a.href+d+a.options.customKeyPrefix))&&b.deserialize(d,function(){c.isFunction(a.options.onRestore)&&a.options.onRestore.call()})})},bindSaveDataImmediately:function(a){var b=this,d;try{d=c(a.get(0)).ckeditorGet()}catch(e){}d?(d.on("saveSnapshot",function(){b.saveAllData()}),d.getCommand("undo").on("afterUndo",function(){b.saveAllData()}),d.getCommand("redo").on("afterRedo",
function(){b.saveAllData()})):null==c.browser.msie?a.get(0).oninput=function(){b.saveAllData()}:a.get(0).onpropertychange=function(){b.saveAllData()}},saveToBrowserStorage:function(a,b,d){d=null==d?!0:d;this.browserStorage.set(a,b);d&&""!==b&&c.isFunction(this.options.onSave)&&this.options.onSave.call()},bindSaveDataOnChange:function(a){var b=this;a.change(function(){b.saveAllData()})},saveDataByTimeout:function(){var a=this;setTimeout(function(){function b(){a.saveAllData();setTimeout(b,1E3*a.options.timeout)}
return b}(a.targets),1E3*a.options.timeout)},bindReleaseData:function(){var a=this;a.targets.each(function(){var b=c(this).attr("id");c(this).bind("submit reset",function(){a.releaseData(b)})})},manuallyReleaseData:function(){var a=this;a.targets.each(function(){var b=c(this).attr("id");a.releaseData(b)})},releaseData:function(a){this.browserStorage.remove(this.href+a+this.options.customKeyPrefix);c.isFunction(this.options.onRelease)&&this.options.onRelease.call()}}}e=f=null;return{getInstance:function(){f||
(f=g(),f.setInitialOptions());return f},free:function(){f=e=void 0;return null}}}()})(jQuery);