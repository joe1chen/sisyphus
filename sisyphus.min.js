(function(b){b.sisyphus=function(){return Sisyphus.getInstance()};b.fn.sisyphus=function(b){var d=Sisyphus.getInstance();d.setOptions(b);d.protect(this);return d};var g={isAvailable:function(){if("object"===typeof b.jStorage)return!0;try{return localStorage.getItem}catch(c){return!1}},set:function(c,d){if("object"===typeof b.jStorage)b.jStorage.set(c,d+"");else try{localStorage.setItem(c,d+"")}catch(f){}},get:function(c){return"object"===typeof b.jStorage?(c=b.jStorage.get(c))?c.toString():c:localStorage.getItem(c)},
remove:function(c){"object"===typeof b.jStorage?b.jStorage.deleteKey(c):localStorage.removeItem(c)}};Sisyphus=function(){var c,d;function f(){return{setInitialOptions:function(a){var e={excludeFields:null,customKeyPrefix:"",timeout:0,autoRelease:!0,onSave:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||b.extend(e,a);this.browserStorage=g},setOptions:function(a){this.options=this.options||this.setInitialOptions(a);this.options=b.extend(this.options,a)},protect:function(a){a=
a||{};this.targets=this.targets||[];this.href=location.hostname+location.pathname+location.search;this.targets=b.merge(this.targets,a);this.targets=b.unique(this.targets);this.targets=b(this.targets);if(!this.browserStorage.isAvailable())return!1;this.restoreAllData();this.options.autoRelease&&this.bindReleaseData();c||(this.bindSaveData(),c=!0)},bindSaveData:function(){var a=this;a.options.timeout&&a.saveDataByTimeout();a.targets.each(function(){b(this).attr("id");b(this).find(":input").not(":submit").not(":reset").not(":button").each(function(){if(-1!==
b.inArray(this,a.options.excludeFields))return!0;var e=b(this);e.is(":text")||e.is("textarea")?a.options.timeout||a.bindSaveDataImmediately(e):a.bindSaveDataOnChange(e)})})},saveAllData:function(){var a=this;a.targets.each(function(){var e=b(this).attr("id"),c=b(this).serialize();a.saveToBrowserStorage(a.href+e+a.options.customKeyPrefix,c,!1)});b.isFunction(a.options.onSave)&&a.options.onSave.call()},restoreAllData:function(){var a=this;a.targets.each(function(){var e=b(this),c=e.attr("id");(c=a.browserStorage.get(a.href+
c+a.options.customKeyPrefix))&&e.deserialize(c,function(){b.isFunction(a.options.onRestore)&&a.options.onRestore.call()})})},bindSaveDataImmediately:function(a){var e=this,c;try{c=b(a.get(0)).ckeditorGet()}catch(d){}c?(c.on("saveSnapshot",function(){e.saveAllData()}),c.getCommand("undo").on("afterUndo",function(){e.saveAllData()}),c.getCommand("redo").on("afterRedo",function(){e.saveAllData()})):null==b.browser.msie?a.get(0).oninput=function(){e.saveAllData()}:a.get(0).onpropertychange=function(){e.saveAllData()}},
saveToBrowserStorage:function(a,c,d){d=null==d?!0:d;this.browserStorage.set(a,c);d&&""!==c&&b.isFunction(this.options.onSave)&&this.options.onSave.call()},bindSaveDataOnChange:function(a){var b=this;a.change(function(){b.saveAllData()})},saveDataByTimeout:function(){var a=this;setTimeout(function(){function b(){a.saveAllData();setTimeout(b,1E3*a.options.timeout)}return b}(a.targets),1E3*a.options.timeout)},bindReleaseData:function(){var a=this;a.targets.each(function(){var c=b(this).attr("id");b(this).bind("submit reset",
function(){a.releaseData(c)})})},manuallyReleaseData:function(){var a=this;a.targets.each(function(){var c=b(this).attr("id");a.releaseData(c)})},releaseData:function(a){this.browserStorage.remove(this.href+a+this.options.customKeyPrefix);b.isFunction(this.options.onRelease)&&this.options.onRelease.call()}}}c=d=null;return{getInstance:function(){d||(d=f(),d.setInitialOptions());return d},free:function(){d=c=void 0;return null}}}()})(jQuery);